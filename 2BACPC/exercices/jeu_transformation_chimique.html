<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jeu pédagogique — Suivi d’une transformation chimique</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root{--accent:#0d6efd}
    body{background:#f7f9fc;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    .app-card{border-radius:14px;box-shadow:0 8px 22px rgba(14,30,37,.08);background:white}
    .kpi{font-weight:700;font-size:1.1rem}
    .small-muted{font-size:.85rem;color:#6c757d}
    .equation{font-family: 'Courier New', Courier, monospace;background:#f1f5fb;padding:.6rem;border-radius:8px}
    .chart-container{height:320px}
    .quiz .card{border-left:6px solid transparent}
    .quiz .card.correct{border-left-color: #198754}
    .quiz .card.wrong{border-left-color: #dc3545}
  </style>
</head>
<body class="p-3 p-md-5">
  <div class="container">
    <header class="d-flex align-items-center mb-4">
      <div class="me-3">
        <svg width="56" height="56" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#0d6efd"/><path d="M8 13c1.1 0 2-.9 2-2V6h4v5c0 1.1.9 2 2 2" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div>
        <h1 class="h4 mb-0">Jeu pédagogique — Suivi d’une transformation chimique</h1>
        <div class="small-muted">Simulation interactive, tableau d'avancement, quiz et exercices.</div>
      </div>
    </header>

    <div class="row g-4">
      <div class="col-lg-7">
        <div class="p-4 app-card">
          <h2 class="h5 mb-3">Simulation — Zn(s) + 2 H<sup>+</sup>(aq) → H<sub>2</sub>(g) + Zn<sup>2+</sup>(aq)</h2>
          <div class="row g-3 align-items-end">
            <div class="col-md-6">
              <label class="form-label">Masse de Zn (g)</label>
              <input id="massZn" type="number" step="0.01" class="form-control" value="3.27">
              <div class="small-muted">Masse molaire M(Zn) = 65.4 g·mol⁻¹</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Volume de HCl (mL)</label>
              <input id="volHCl" type="number" step="1" class="form-control" value="10">
            </div>
            <div class="col-md-6">
              <label class="form-label">Concentration HCl (mol·L⁻¹)</label>
              <input id="cHCl" type="number" step="0.01" class="form-control" value="4">
            </div>
            <div class="col-md-6">
              <label class="form-label">Volume molaire (L·mol⁻¹)</label>
              <input id="Vm" type="number" step="0.01" class="form-control" value="24">
            </div>

            <div class="col-12">
              <button id="calcBtn" class="btn btn-primary">Calculer avancement & mettre à jour</button>
              <button id="resetBtn" class="btn btn-outline-secondary ms-2">Réinitialiser</button>
            </div>
          </div>

          <hr>

          <div class="row gy-3">
            <div class="col-md-6">
              <div class="p-3 border rounded">
                <div class="small-muted">Moles initiales</div>
                <div class="kpi mt-1">Zn: <span id="nZn">-</span> mol</div>
                <div class="kpi">H⁺: <span id="nH">-</span> mol</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-3 border rounded">
                <div class="small-muted">Avancement maximal</div>
                <div class="kpi mt-1">x<sub>max</sub>: <span id="xmax">-</span> mol</div>
                <div class="small-muted">Réactif limitant: <strong id="limiting">-</strong></div>
              </div>
            </div>

            <div class="col-12">
              <div class="equation mb-2">Équation: <strong>Zn(s) + 2 H<sup>+</sup>(aq) → H<sub>2</sub>(g) + Zn<sup>2+</sup>(aq)</strong></div>

              <label class="form-label">Choisissez l'avancement x (mol)</label>
              <input id="xRange" type="range" min="0" max="1" step="0.001" class="form-range">
              <div class="d-flex justify-content-between small-muted">
                <div>0 mol</div>
                <div id="xVal">x = 0.000 mol</div>
                <div id="xMaxLabel">x<sub>max</sub> = -</div>
              </div>

              <div class="mt-3 chart-container">
                <canvas id="chart"></canvas>
              </div>

              <div class="mt-3">
                <h6>Tableau d'avancement (instantané)</h6>
                <table class="table table-sm">
                  <thead>
                    <tr><th>Espèce</th><th>Initial (mol)</th><th>Variation (mol)</th><th>Actuel (mol)</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Zn(s)</td><td id="tiZn">-</td><td id="dvZn">-</td><td id="nfZn">-</td></tr>
                    <tr><td>H⁺(aq)</td><td id="tiH">-</td><td id="dvH">-</td><td id="nfH">-</td></tr>
                    <tr><td>H₂(g)</td><td id="tiH2">-</td><td id="dvH2">-</td><td id="nfH2">-</td></tr>
                    <tr><td>Zn²⁺(aq)</td><td id="tiZn2">-</td><td id="dvZn2">-</td><td id="nfZn2">-</td></tr>
                  </tbody>
                </table>
              </div>

            </div>
          </div>
        </div>

        <div class="p-4 app-card mt-4">
          <h2 class="h5">Exercice guidé automatique</h2>
          <ol>
            <li>Entrez les données expérimentales (déjà remplies par défaut).</li>
            <li>Cliquez sur <em>Calculer</em>. L'outil déterminera le réactif limitant et x<sub>max</sub>.</li>
            <li>Faites varier x et observez la composition du système et le volume attendu de H<sub>2</sub>.</li>
          </ol>
          <div class="mt-3 small-muted">Astuce: comparez le volume théorique de H<sub>2</sub> (V = n(H₂)·V<sub>m</sub>) avec la valeur expérimentale fournie dans la leçon (0.438 L) pour évaluer la précision.</div>
        </div>

      </div>

      <div class="col-lg-5">
        <div class="p-4 app-card">
          <h3 class="h6">Quiz rapide</h3>
          <div class="quiz mt-3" id="quizArea">
            <!-- questions populated by JS -->
          </div>
          <div class="mt-3 d-flex justify-content-between align-items-center">
            <div id="scoreText">Score: -</div>
            <button id="submitQuiz" class="btn btn-success">Soumettre</button>
          </div>
        </div>

        <div class="p-4 app-card mt-4">
          <h3 class="h6">Outils pour le professeur</h3>
          <ul class="small-muted">
            <li>Mode démonstration: partagez l'écran et manipulez le curseur pour expliquer le tableau d'avancement.</li>
            <li>Utilisez les champs modifiables pour créer variantes d'exercice (changer masses, volumes, concentrations).</li>
            <li>Imprimer la page pour obtenir une fiche d'activité (CTRL+P).</li>
          </ul>
          <button id="exportPNG" class="btn btn-outline-primary mt-2">Exporter graphique (PNG)</button>
        </div>

      </div>

    </div>

    <footer class="text-muted mt-5 small">Conçu pour la leçon "Suivi d'une transformation chimique" — code pédagogique interactif. Vous pouvez adapter l'équation et les paramètres pour d'autres transformations.</footer>
  </div>

<script>
  // Constants
  const M_ZN = 65.4; // g·mol-1

  // DOM
  const massZn = document.getElementById('massZn');
  const volHCl = document.getElementById('volHCl');
  const cHCl = document.getElementById('cHCl');
  const Vm = document.getElementById('Vm');
  const calcBtn = document.getElementById('calcBtn');
  const resetBtn = document.getElementById('resetBtn');
  const nZnEl = document.getElementById('nZn');
  const nHEl = document.getElementById('nH');
  const xmaxEl = document.getElementById('xmax');
  const limitingEl = document.getElementById('limiting');
  const xRange = document.getElementById('xRange');
  const xVal = document.getElementById('xVal');
  const xMaxLabel = document.getElementById('xMaxLabel');

  const tiZn = document.getElementById('tiZn');
  const tiH = document.getElementById('tiH');
  const tiH2 = document.getElementById('tiH2');
  const tiZn2 = document.getElementById('tiZn2');
  const dvZn = document.getElementById('dvZn');
  const dvH = document.getElementById('dvH');
  const dvH2 = document.getElementById('dvH2');
  const dvZn2 = document.getElementById('dvZn2');
  const nfZn = document.getElementById('nfZn');
  const nfH = document.getElementById('nfH');
  const nfH2 = document.getElementById('nfH2');
  const nfZn2 = document.getElementById('nfZn2');

  // Chart
  const ctx = document.getElementById('chart');
  let chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {label:'Zn (mol)', data:[], tension:0.3, fill:false},
        {label:'H+ (mol)', data:[], tension:0.3, fill:false},
        {label:'H2 (mol)', data:[], tension:0.3, fill:false},
        {label:'Zn2+ (mol)', data:[], tension:0.3, fill:false}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{position:'top'}}
    }
  });

  let state = {
    niZn:0, niH:0, xmax:0, limiting:'-', currentX:0
  };

  function toFixedSafe(v){return Number.parseFloat(v).toFixed(3)}

  function computeInitial(){
    const mZn = parseFloat(massZn.value) || 0;
    const V_HCl_L = (parseFloat(volHCl.value) || 0)/1000;
    const C_HCl = parseFloat(cHCl.value) || 0;
    const nZn = mZn / M_ZN;
    const nH = C_HCl * V_HCl_L; // mol
    state.niZn = nZn;
    state.niH = nH;
    // compute xmax candidates: Zn consumed 1 per x -> x1 = nZn
    const xmax1 = nZn;
    // H+ consumed 2 per x -> x2 = nH / 2
    const xmax2 = nH / 2;
    if(xmax1 < xmax2){ state.xmax = xmax1; state.limiting='Zn'; }
    else { state.xmax = xmax2; state.limiting='H+'; }
    // update UI
    nZnEl.textContent = toFixedSafe(nZn);
    nHEl.textContent = toFixedSafe(nH);
    xmaxEl.textContent = toFixedSafe(state.xmax);
    limitingEl.textContent = state.limiting;
    xRange.max = Math.max( (state.xmax*1.2).toString(), state.xmax.toString(), '0.001');
    xRange.value = 0;
    xVal.textContent = `x = ${toFixedSafe(0) } mol`;
    xMaxLabel.textContent = `x_max = ${toFixedSafe(state.xmax)} mol`;

    // populate instant table initial column
    tiZn.textContent = toFixedSafe(nZn);
    tiH.textContent = toFixedSafe(nH);
    tiH2.textContent = '0.000';
    tiZn2.textContent = '0.000';

    updateChart();
  }

  function updateForX(x){
    state.currentX = x;
    xVal.textContent = `x = ${toFixedSafe(x)} mol`;
    // variations according to reaction stoich: Zn -x ; H+ -2x ; H2 +x ; Zn2+ +x
    const dvZnVal = -x;
    const dvHVal  = -2*x;
    const dvH2Val = x;
    const dvZn2Val = x;
    const nfZnVal = state.niZn + dvZnVal;
    const nfHVal = state.niH + dvHVal;
    const nfH2Val = dvH2Val; // started 0
    const nfZn2Val = dvZn2Val;

    dvZn.textContent = toFixedSafe(dvZnVal);
    dvH.textContent = toFixedSafe(dvHVal);
    dvH2.textContent = toFixedSafe(dvH2Val);
    dvZn2.textContent = toFixedSafe(dvZn2Val);

    nfZn.textContent = toFixedSafe(nfZnVal);
    nfH.textContent = toFixedSafe(Math.max(0,nfHVal));
    nfH2.textContent = toFixedSafe(nfH2Val);
    nfZn2.textContent = toFixedSafe(nfZn2Val);

    // update chart point for this x
    addPointToChart(x, nfZnVal, nfHVal, nfH2Val, nfZn2Val);
  }

  function updateChart(){
    // draw curves from x=0 to x = x_max (100 points)
    const steps = 80;
    const labels = [];
    const ZnData = [], HData = [], H2Data = [], Zn2Data = [];
    for(let i=0;i<=steps;i++){
      const x = state.xmax * (i/steps);
      labels.push(x.toFixed(3));
      ZnData.push( (state.niZn - x).toFixed(6) );
      HData.push( (state.niH - 2*x).toFixed(6) );
      H2Data.push( (0 + x).toFixed(6) );
      Zn2Data.push( (0 + x).toFixed(6) );
    }
    chart.data.labels = labels;
    chart.data.datasets[0].data = ZnData;
    chart.data.datasets[1].data = HData;
    chart.data.datasets[2].data = H2Data;
    chart.data.datasets[3].data = Zn2Data;
    chart.update();
  }

  function addPointToChart(x, zn, h, h2, zn2){
    // place a vertical marker by adding a special dataset with a point at the current x
    // We'll just update chart and rely on existing datasets; also we draw a vertical line via plugin-free approach: show tooltip for nearest label
    // find closest label index
    let closestIndex = 0; let minDiff = Infinity;
    chart.data.labels.forEach((lab,i)=>{ const v = parseFloat(lab); const diff = Math.abs(v - x); if(diff<minDiff){minDiff=diff;closestIndex=i;}});
    // create a small overlay dataset for the marker
    // update 'active' point by temporarily creating datasets
    // For simplicity: set pointRadius large at datasets and use segment? To avoid complexity, we simply leave chart as is and highlight via table above.

  }

  // Event listeners
  calcBtn.addEventListener('click', ()=>{
    computeInitial();
  });
  resetBtn.addEventListener('click', ()=>{
    massZn.value = 3.27; volHCl.value = 10; cHCl.value = 4; Vm.value = 24; computeInitial();
  });

  xRange.addEventListener('input', ()=>{
    const x = parseFloat(xRange.value);
    updateForX(x);
    // compute expected V(H2) and display in tooltip of chart (not shown) — but we keep it in console for teacher
    const nH2 = x;
    const VmVal = parseFloat(Vm.value) || 24;
    const Vtheo = nH2 * VmVal; // L
    // update xmax label
    xMaxLabel.textContent = `x_max = ${toFixedSafe(state.xmax)} mol`;
  });

  // Initialize default
  computeInitial();

  // --- Quiz logic ---
  const quizQuestions = [
    {q:'Quel est le gaz formé lors de la réaction Zn + 2H+ ?', choices:['O2','H2','Cl2','CO2'], a:1},
    {q:'Quelle est la relation stoéchiométrique entre Zn et H+ ?', choices:['1 Zn : 1 H+','1 Zn : 2 H+','2 Zn : 1 H+','1 Zn : 3 H+'], a:1},
    {q:'Si n(Zn)=0.05 mol et n(H+)=0.04 mol, quel est le réactif limitant ?', choices:['Zn','H+','Ni l'un ni l'autre','Impossible à dire'], a:1},
    {q:'L'avancement maximal x_max est de 0.02 mol. Quelle quantité de H2 est formée ?', choices:['0.01 mol','0.02 mol','0.04 mol','0.00 mol'], a:1}
  ];

  const quizArea = document.getElementById('quizArea');
  function renderQuiz(){
    quizArea.innerHTML = '';
    quizQuestions.forEach((qq,i)=>{
      const card = document.createElement('div'); card.className='card mb-2 p-2';
      const body = document.createElement('div'); body.className='card-body p-2';
      const title = document.createElement('div'); title.innerHTML = `<strong>Q${i+1}.</strong> ${qq.q}`;
      body.appendChild(title);
      qq.choices.forEach((c,j)=>{
        const id = `q${i}_c${j}`;
        const div = document.createElement('div'); div.className='form-check';
        div.innerHTML = `<input class='form-check-input' type='radio' name='q${i}' id='${id}' value='${j}'><label class='form-check-label' for='${id}'>${c}</label>`;
        body.appendChild(div);
      });
      card.appendChild(body); quizArea.appendChild(card);
    });
  }
  renderQuiz();

  document.getElementById('submitQuiz').addEventListener('click', ()=>{
    let score = 0;
    quizQuestions.forEach((qq,i)=>{
      const selected = document.querySelector(`input[name='q${i}']:checked`);
      const card = quizArea.children[i];
      if(selected){
        const val = parseInt(selected.value);
        if(val === qq.a){ score++; card.classList.add('correct'); card.classList.remove('wrong'); }
        else { card.classList.add('wrong'); card.classList.remove('correct'); }
      } else { card.classList.add('wrong'); card.classList.remove('correct'); }
    });
    document.getElementById('scoreText').textContent = `Score: ${score} / ${quizQuestions.length}`;
  });

  // Export chart PNG
  document.getElementById('exportPNG').addEventListener('click', ()=>{
    const a = document.createElement('a');
    a.href = chart.toBase64Image();
    a.download = 'graph_avancement.png';
    a.click();
  });

</script>
</body>
</html>
